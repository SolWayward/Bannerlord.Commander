<Prefab>
  <Window>
    <Widget Id="ClanSelectionPopup" DataSource="{ClanSelectionPopup}"
  WidthSizePolicy="StretchToParent"
  HeightSizePolicy="StretchToParent"
  IsVisible="@IsVisible">
      <Children>
    <!-- Dark semi-transparent background overlay -->
        <ButtonWidget Id="BackgroundOverlay" DoNotPassEventsToChildren="true"
          WidthSizePolicy="StretchToParent"
          HeightSizePolicy="StretchToParent"
          Sprite="BlankWhiteSquare_9"
          Color="#000000AA"
          Command.Click="ExecuteClose" />

    <!-- Popup container (centered) -->
        <BrushWidget Id="PopupContainer" WidthSizePolicy="Fixed"
          HeightSizePolicy="Fixed"
          SuggestedWidth="900"
          SuggestedHeight="800"
          HorizontalAlignment="Center"
          VerticalAlignment="Center"
          Brush="HeroEditor.Panel.Background">
          <Children>

        <!-- Border Frame -->
            <BrushWidget Id="PopupTopBorder" WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed"
              SuggestedHeight="2" VerticalAlignment="Top"
              Brush="HeroEditor.Section.Border" />
            <BrushWidget Id="PopupBottomBorder" WidthSizePolicy="StretchToParent"
              HeightSizePolicy="Fixed"
              SuggestedHeight="2" VerticalAlignment="Bottom"
              Brush="HeroEditor.Section.Border" />
            <BrushWidget Id="PopupLeftBorder" WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent"
              SuggestedWidth="2" HorizontalAlignment="Left"
              Brush="HeroEditor.Section.Border" />
            <BrushWidget Id="PopupRightBorder" WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent"
              SuggestedWidth="2" HorizontalAlignment="Right"
              Brush="HeroEditor.Section.Border" />

        <!-- Content Container -->
            <ListPanel Id="PopupContentPanel" WidthSizePolicy="StretchToParent"
              HeightSizePolicy="StretchToParent"
              MarginTop="15"
              MarginBottom="15"
              MarginLeft="15"
              MarginRight="15"
              StackLayout.LayoutMethod="VerticalBottomToTop">
              <Children>

            <!-- Header -->
                <Widget Id="HeaderContainer" WidthSizePolicy="StretchToParent"
                  HeightSizePolicy="Fixed"
                  SuggestedHeight="50"
                  MarginBottom="15">
                  <Children>
                    <TextWidget Id="HeaderTitle" WidthSizePolicy="StretchToParent"
                      HeightSizePolicy="StretchToParent"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Brush="TownManagement.Description.Title.Text"
                      Brush.FontSize="26"
                      Text="Select Clan" />
                  </Children>
                </Widget>

            <!-- Filter Input -->
                <Widget Id="FilterInputContainer" WidthSizePolicy="StretchToParent"
                  HeightSizePolicy="Fixed"
                  SuggestedHeight="40"
                  MarginBottom="15">
                  <Children>
                    <TextWidget Id="FilterLabel" WidthSizePolicy="Fixed"
                      HeightSizePolicy="StretchToParent"
                      SuggestedWidth="80"
                      HorizontalAlignment="Left"
                      VerticalAlignment="Center"
                      Brush="Clan.TabControl.Text"
                      Brush.FontSize="18"
                      Text="Filter:" />

                    <BrushWidget Id="FilterInputBox" WidthSizePolicy="StretchToParent"
                      HeightSizePolicy="StretchToParent"
                      MarginLeft="90"
                      Brush="HeroEditor.Input.Background">
                      <Children>
                    <!-- Border frame -->
                        <BrushWidget Id="FilterInputTopBorder" WidthSizePolicy="StretchToParent"
                          HeightSizePolicy="Fixed"
                          SuggestedHeight="1" VerticalAlignment="Top"
                          Brush="HeroEditor.Section.Border" />
                        <BrushWidget Id="FilterInputBottomBorder" WidthSizePolicy="StretchToParent"
                          HeightSizePolicy="Fixed"
                          SuggestedHeight="1" VerticalAlignment="Bottom"
                          Brush="HeroEditor.Section.Border" />
                        <BrushWidget Id="FilterInputLeftBorder" WidthSizePolicy="Fixed"
                          HeightSizePolicy="StretchToParent"
                          SuggestedWidth="1" HorizontalAlignment="Left"
                          Brush="HeroEditor.Section.Border" />
                        <BrushWidget Id="FilterInputRightBorder" WidthSizePolicy="Fixed"
                          HeightSizePolicy="StretchToParent"
                          SuggestedWidth="1" HorizontalAlignment="Right"
                          Brush="HeroEditor.Section.Border" />

                        <EditableTextWidget Id="FilterInput" WidthSizePolicy="StretchToParent"
                          HeightSizePolicy="StretchToParent"
                          MarginLeft="6"
                          MarginRight="6"
                          MarginTop="6"
                          MarginBottom="6"
                          Brush="Clan.TabControl.Text"
                          Brush.FontSize="16"
                          Text="@FilterText" />
                      </Children>
                    </BrushWidget>
                  </Children>
                </Widget>

            <!-- Scrollable Clan List -->
                <Widget Id="ClanListContainer" WidthSizePolicy="StretchToParent"
                  HeightSizePolicy="StretchToParent"
                  MarginBottom="15">
                  <Children>

                    <ScrollablePanel Id="ClanScrollablePanel"
                      WidthSizePolicy="StretchToParent"
                      HeightSizePolicy="StretchToParent"
                      MarginRight="25"
                      AutoHideScrollBars="true"
                      ClipRect="ClanClipRect"
                      InnerPanel="ClanClipRect\ClanInnerPanel"
                      VerticalScrollbar="..\ClanScrollbarContainer\ClanScrollbar">
                      <Children>

                        <Widget Id="ClanClipRect"
                          WidthSizePolicy="StretchToParent"
                          HeightSizePolicy="StretchToParent"
                          ClipContents="true">
                          <Children>

                            <ListPanel Id="ClanInnerPanel"
                              WidthSizePolicy="StretchToParent"
                              HeightSizePolicy="CoverChildren"
                              DataSource="{Clans}"
                              StackLayout.LayoutMethod="VerticalBottomToTop">
                              <ItemTemplate>

                            <!-- Clan Item Template -->
                                <ButtonWidget Id="ClanItemButton" DoNotPassEventsToChildren="true"
                                  UpdateChildrenStates="true"
                                  WidthSizePolicy="StretchToParent"
                                  HeightSizePolicy="Fixed"
                                  SuggestedHeight="100"
                                  MarginBottom="5"
                                  Brush="Commander.HeroRow"
                                  Command.Click="ExecuteSelect">
                                  <Children>

                                    <ListPanel Id="ClanItemLayout" WidthSizePolicy="StretchToParent"
                                      HeightSizePolicy="StretchToParent"
                                      MarginLeft="10"
                                      MarginRight="10"
                                      MarginTop="10"
                                      MarginBottom="10"
                                      StackLayout.LayoutMethod="HorizontalLeftToRight">
                                      <Children>

                                    <!-- Clan Banner -->
                                        <Widget Id="ClanBannerContainer" WidthSizePolicy="Fixed"
                                          HeightSizePolicy="Fixed"
                                          SuggestedWidth="80"
                                          SuggestedHeight="80"
                                          MarginRight="15">
                                          <Children>
                                            <ImageWidget WidthSizePolicy="StretchToParent"
                                              HeightSizePolicy="StretchToParent"
                                              DataSource="{Banner}"
                                              ImageTypeCode="@ImageTypeCode"
                                              AdditionalArgs="@AdditionalArgs"
                                              ImageId="@ImageId"
                                              Id="@Id" />
                                          </Children>
                                        </Widget>

                                    <!-- Clan Info -->
                                        <ListPanel Id="ClanInfoLayout"
                                          WidthSizePolicy="StretchToParent"
                                          HeightSizePolicy="StretchToParent"
                                          StackLayout.LayoutMethod="VerticalBottomToTop">
                                          <Children>

                                        <!-- Clan Name -->
                                            <Widget Id="ClanNameContainer"
                                              WidthSizePolicy="StretchToParent"
                                              HeightSizePolicy="Fixed"
                                              SuggestedHeight="28"
                                              MarginBottom="5">
                                              <Children>
                                                <TextWidget Id="ClanNameText"
                                                  WidthSizePolicy="StretchToParent"
                                                  HeightSizePolicy="StretchToParent"
                                                  HorizontalAlignment="Left"
                                                  VerticalAlignment="Center"
                                                  Brush="TownManagement.Description.Title.Text"
                                                  Brush.FontSize="20"
                                                  Text="@ClanName" />
                                              </Children>
                                            </Widget>

                                        <!-- Kingdom Name -->
                                            <Widget Id="KingdomNameContainer"
                                              WidthSizePolicy="StretchToParent"
                                              HeightSizePolicy="Fixed"
                                              SuggestedHeight="22"
                                              MarginBottom="3">
                                              <Children>
                                                <TextWidget Id="KingdomLabel"
                                                  WidthSizePolicy="Fixed"
                                                  HeightSizePolicy="StretchToParent"
                                                  SuggestedWidth="90"
                                                  HorizontalAlignment="Left"
                                                  VerticalAlignment="Center"
                                                  Brush="Clan.TabControl.Text"
                                                  Brush.FontSize="16"
                                                  Text="Kingdom:" />
                                                <TextWidget Id="KingdomNameText"
                                                  WidthSizePolicy="StretchToParent"
                                                  HeightSizePolicy="StretchToParent"
                                                  MarginLeft="95"
                                                  HorizontalAlignment="Left"
                                                  VerticalAlignment="Center"
                                                  Brush="Clan.TabControl.Text"
                                                  Brush.FontSize="16"
                                                  Text="@KingdomName" />
                                              </Children>
                                            </Widget>

                                        <!-- Tier and Member Count -->
                                            <ListPanel Id="TierMemberRow"
                                              WidthSizePolicy="StretchToParent"
                                              HeightSizePolicy="Fixed"
                                              SuggestedHeight="22"
                                              StackLayout.LayoutMethod="HorizontalLeftToRight">
                                              <Children>
                                                <Widget Id="TierContainer"
                                                  WidthSizePolicy="CoverChildren"
                                                  HeightSizePolicy="StretchToParent"
                                                  MarginRight="20">
                                                  <Children>
                                                    <TextWidget Id="TierText"
                                                      WidthSizePolicy="CoverChildren"
                                                      HeightSizePolicy="StretchToParent"
                                                      VerticalAlignment="Center"
                                                      Brush="Clan.TabControl.Text"
                                                      Brush.FontSize="16"
                                                      Text="@TierText" />
                                                  </Children>
                                                </Widget>
                                                <Widget Id="MemberCountContainer"
                                                  WidthSizePolicy="CoverChildren"
                                                  HeightSizePolicy="StretchToParent">
                                                  <Children>
                                                    <TextWidget Id="MembersLabel"
                                                      WidthSizePolicy="CoverChildren"
                                                      HeightSizePolicy="StretchToParent"
                                                      VerticalAlignment="Center"
                                                      Brush="Clan.TabControl.Text"
                                                      Brush.FontSize="16"
                                                      Text="Members: " />
                                                    <TextWidget Id="MemberCountText"
                                                      WidthSizePolicy="CoverChildren"
                                                      HeightSizePolicy="StretchToParent"
                                                      MarginLeft="75"
                                                      VerticalAlignment="Center"
                                                      Brush="Clan.TabControl.Text"
                                                      Brush.FontSize="16"
                                                      IntText="@MemberCount" />
                                                  </Children>
                                                </Widget>
                                              </Children>
                                            </ListPanel>

                                          </Children>
                                        </ListPanel>

                                      </Children>
                                    </ListPanel>

                                  </Children>
                                </ButtonWidget>

                              </ItemTemplate>
                            </ListPanel>

                          </Children>
                        </Widget>

                      </Children>
                    </ScrollablePanel>

                <!-- Scrollbar Container -->
                    <Widget Id="ClanScrollbarContainer"
                      WidthSizePolicy="Fixed"
                      HeightSizePolicy="StretchToParent"
                      SuggestedWidth="25"
                      HorizontalAlignment="Right">
                      <Children>
                        <ScrollbarWidget Id="ClanScrollbar"
                          WidthSizePolicy="Fixed"
                          HeightSizePolicy="StretchToParent"
                          SuggestedWidth="20"
                          MinValue="0"
                          MaxValue="100"
                          AlignmentAxis="Vertical"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Top"
                          Handle="ClanScrollbarHandle">
                          <Children>
                            <BrushWidget Id="ClanScrollbarHandle"
                              WidthSizePolicy="Fixed"
                              HeightSizePolicy="Fixed"
                              SuggestedWidth="20"
                              MinHeight="30"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Top"
                              Brush="HeroEditor.Section.Border" />
                          </Children>
                        </ScrollbarWidget>
                      </Children>
                    </Widget>

                  </Children>
                </Widget>

            <!-- Close Button -->
                <ButtonWidget Id="CloseButton" DoNotPassEventsToChildren="true"
                  UpdateChildrenStates="true"
                  WidthSizePolicy="Fixed"
                  HeightSizePolicy="Fixed"
                  SuggestedWidth="150"
                  SuggestedHeight="40"
                  HorizontalAlignment="Center"
                  Command.Click="ExecuteClose">
                  <Children>
                    <BrushWidget Id="CloseButtonBackground" WidthSizePolicy="StretchToParent"
                      HeightSizePolicy="StretchToParent"
                      Brush="HeroEditor.Button.Standard" />
                <!-- Border frame -->
                    <BrushWidget Id="CloseButtonTopBorder" WidthSizePolicy="StretchToParent"
                      HeightSizePolicy="Fixed"
                      SuggestedHeight="1" VerticalAlignment="Top"
                      Brush="HeroEditor.Section.Border" />
                    <BrushWidget Id="CloseButtonBottomBorder" WidthSizePolicy="StretchToParent"
                      HeightSizePolicy="Fixed"
                      SuggestedHeight="1" VerticalAlignment="Bottom"
                      Brush="HeroEditor.Section.Border" />
                    <BrushWidget Id="CloseButtonLeftBorder" WidthSizePolicy="Fixed"
                      HeightSizePolicy="StretchToParent"
                      SuggestedWidth="1" HorizontalAlignment="Left"
                      Brush="HeroEditor.Section.Border" />
                    <BrushWidget Id="CloseButtonRightBorder" WidthSizePolicy="Fixed"
                      HeightSizePolicy="StretchToParent"
                      SuggestedWidth="1" HorizontalAlignment="Right"
                      Brush="HeroEditor.Section.Border" />
                    <TextWidget Id="CloseButtonText" WidthSizePolicy="StretchToParent"
                      HeightSizePolicy="StretchToParent"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Brush="Clan.TabControl.Text"
                      Brush.FontSize="18"
                      Text="Close" />
                  </Children>
                </ButtonWidget>

              </Children>
            </ListPanel>

          </Children>
        </BrushWidget>

      </Children>
    </Widget>
  </Window>
</Prefab>
